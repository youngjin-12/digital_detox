<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¹„ë© ë””í†¡ìŠ¤</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* =========================================
       1. ê¸°ë³¸ ì„¤ì • ë° ë¹„ë© ë°°ê²½ ìŠ¤íƒ€ì¼
       ========================================= */
    body {
        margin: 0;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #333;
        font-family: system-ui, -apple-system, sans-serif;
        color: #fff;
    }

    .window-scene {
        position: relative;
        width: 100vw;
        height: 100vh;
        background-color: #1a1a2e; 
        background-image: url('ë°°ê²½3.jpg'); 
        background-size: cover;
        background-position: center;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        cursor: pointer;
        overflow: hidden;
        user-select: none; 
    }

    #guideText {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: rgba(255, 255, 255, 0.9);
        font-size: 20px;
        font-weight: bold;
        text-shadow: 0 0 10px rgba(0,0,0,0.8);
        z-index: 90;
        pointer-events: none;
        transition: opacity 0.5s;
    }

    #rainCanvas {
        position: absolute;
        top: 0%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 65vw; 
        height: 180vh; 
        pointer-events: none;
        z-index: 1;
    }

    /* ë°˜ë”§ë¶ˆì´ */
    .firefly {
        position: absolute;
        width: 8px;
        height: 8px;
        background-color: #ffffcc;
        border-radius: 50%;
        box-shadow: 0 0 5px #ffffcc, 0 0 10px #ffdd55;
        opacity: 0;
        pointer-events: none;
        z-index: 3;
    }

    @keyframes floatUp {
        0% { opacity: 0; transform: translate(0, 0) scale(0.5); }
        20% { opacity: 0.8; transform: translate(10px, -20px) scale(1); }
        80% { opacity: 0.6; }
        100% { opacity: 0; transform: translate(-20px, -80px) scale(0.2); }
    }

    /* í™”ë¶„ */
    .pot-img {
        position: absolute;
        width: 280px;
        height: 280px; 
        background-color: transparent; 
        border: none;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: bottom center;
        z-index: 2;
        opacity: 0;
        transition: opacity 0.5s;
        transform: translate(-50%, -50%);
        pointer-events: none; 
    }

    /* =========================================
       2. ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ (ìë™ ìˆ¨ê¹€ ì ìš©)
       ========================================= */
    .sidebar-overlay {
        position: fixed;
        right: -320px; /* í™”ë©´ ë°–ìœ¼ë¡œ ìˆ¨ê¹€ */
        top: 50%;
        transform: translateY(-50%);
        width: 260px;
        z-index: 200;
        display: flex;
        flex-direction: column;
        gap: 12px;
        transition: right 0.5s cubic-bezier(0.25, 1, 0.5, 1); /* ë¶€ë“œëŸ¬ìš´ ìŠ¬ë¼ì´ë”© */
        padding-left: 20px; /* ë§ˆìš°ìŠ¤ ê°ì§€ ì˜ì—­ */
    }

    /* ë§ˆìš°ìŠ¤ê°€ ê°€ê¹Œì´ ì˜¤ë©´ í™œì„±í™” */
    .sidebar-overlay.active {
        right: 50px;
    }

    .control-card {
        background: rgba(0, 20, 40, 0.30);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 16px 18px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        color: #fff;
    }

    .control-card h2 {
        margin: 0 0 4px 0;
        font-size: 0.9rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        display: flex; align-items: center; gap: 8px;
    }
    .control-card h2 .emoji { font-size: 1rem; }

    .card-desc {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 10px;
    }

    .timer-area {
        display: flex; flex-direction: column; align-items: center; margin-bottom: 8px;
    }
    .timer-inputs {
        display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 4px;
    }
    .timer-inputs input {
        width: 46px; padding: 4px; border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(0, 0, 0, 0.3); color: #fff;
        text-align: center; font-size: 0.85rem;
    }
    .timer-display {
        font-size: 1.6rem; font-family: monospace; font-weight: 500;
        margin: 4px 0 8px 0; letter-spacing: 1px;
        text-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }

    /* === ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìˆ˜ì • (ì™„ì „ íˆ¬ëª…í™”) === */
    .btn {
        width: 100%; padding: 7px 0; margin-bottom: 6px;
        background: transparent; /* ë°°ê²½ íˆ¬ëª…í•˜ê²Œ */
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 50px; 
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.85rem;
        cursor: pointer; transition: all 0.2s ease;
    }
    .btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.5);
        color: #fff;
    }
    .btn:last-child { margin-bottom: 0; }
    
    /* Primary(ì‹œì‘, ì ê¸ˆ) ë²„íŠ¼ë„ ì¼ë°˜ ë²„íŠ¼ê³¼ ë˜‘ê°™ì´ */
    .btn.primary {
        background: transparent; /* ë°°ê²½ìƒ‰ ì œê±° */
        border-color: rgba(255, 255, 255, 0.15); /* í…Œë‘ë¦¬ë„ í†µì¼ */
        color: rgba(255, 255, 255, 0.8);
    }
    .btn.primary:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.5);
        color: #fff;
    }

    /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ì€ ë°°ê²½ ìœ ì§€ */
    .back-btn-container { margin-top: 4px; }
    .back-btn {
        width: 100%; padding: 9px;
        background: rgba(0, 20, 40, 0.30);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 50px; color: #fff; font-size: 0.85rem;
        cursor: pointer; text-align: center; transition: 0.2s;
    }
    .back-btn:hover { 
        background: rgba(10, 40, 70, 0.5);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.3);
    }

    .status-text {
        font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-top: 6px;
    }

    .sound-btn.active {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
    }
</style>
</head>
<body>

    <div class="window-scene" id="scene">
        <div id="guideText">ì„ ë°˜ ìœ„ë¥¼ í´ë¦­í•´ í™”ë¶„ì„ ë†“ì•„ë³´ì„¸ìš”</div>
        <canvas id="rainCanvas"></canvas>
        <div class="pot-img" id="pot"></div>
    </div>

    <audio id="rainSound" loop>
        <source src="gentle-rain-07-437321.mp3" type="audio/mp3">
    </audio>
    <audio id="alarmSound" src="AlramSound.mp3" preload="auto"></audio>

    <aside class="sidebar-overlay">
        
        <section class="control-card">
            <h2><span class="emoji">â°</span> íƒ€ì´ë¨¸</h2>
            <div class="card-desc">ë””í†¡ìŠ¤ ì‹œê°„ ì„¤ì •</div>
            
            <div class="timer-area">
                <div class="timer-inputs">
                    <input id="timerMin" type="number" placeholder="ë¶„" min="0"> : 
                    <input id="timerSec" type="number" placeholder="ì´ˆ" min="0">
                </div>
                <div id="timerDisplay" class="timer-display">00:00</div>
            </div>

            <button id="timerStartBtn" class="btn primary">ì‹œì‘</button>
            <button id="timerPauseBtn" class="btn">ì¼ì‹œì •ì§€</button>
            <button id="timerResetBtn" class="btn">ì´ˆê¸°í™”</button>
        </section>

        <section class="control-card">
            <h2><span class="emoji">ğŸ”’</span> ë””í†¡ìŠ¤ ì ê¸ˆ</h2>
            <div class="card-desc">ë””í†¡ìŠ¤ ì„¸ì…˜ ë™ì•ˆ ë°©í•´ ê¸ˆì§€</div>
            
            <button id="detoxLockBtn" class="btn primary">ì ê¸ˆ ì‹œì‘</button>
            <div id="lockStatus" class="status-text">ìƒíƒœ: ëŒ€ê¸° ì¤‘</div>
        </section>

        <section class="control-card">
            <h2><span class="emoji">ğŸµ</span> ë°°ê²½ ì†Œë¦¬</h2>
            <button class="btn sound-btn" data-sound="none">ë„ê¸°</button>
            <button class="btn sound-btn" data-sound="calm">ì”ì”í•˜ê²Œ</button>
            <button class="btn sound-btn" data-sound="bright">ê²½ì¾Œí•˜ê²Œ</button>
        </section>

        <div class="back-btn-container">
            <button id="backBtn" class="back-btn">â† ì´ì „ í˜ì´ì§€</button>
        </div>

    </aside>

<script>
    /* =====================================
       0. ì‚¬ì´ë“œë°” ë§ˆìš°ìŠ¤ ê°ì§€ (ìë™ ìˆ¨ê¹€/í‘œì‹œ)
       ===================================== */
    const sidebar = document.querySelector('.sidebar-overlay');
    
    document.addEventListener('mousemove', (e) => {
        const screenWidth = window.innerWidth;
        const mouseX = e.clientX;
        
        // í™”ë©´ ì˜¤ë¥¸ìª½ ë 100px ì´ë‚´ or ì‚¬ì´ë“œë°” ë‚´ë¶€
        const isNearRightEdge = (screenWidth - mouseX) < 100;
        const isInsideSidebar = sidebar.contains(e.target) || 
                                (mouseX > (screenWidth - 320));

        if (isNearRightEdge || isInsideSidebar) {
            sidebar.classList.add('active');
        } else {
            sidebar.classList.remove('active');
        }
    });

    // ========== 1. ë¹„ ì• ë‹ˆë©”ì´ì…˜ ==========
    const canvas = document.getElementById('rainCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    const drops = [];
    const numDrops = 200;

    class Drop {
        constructor() {
            this.reset();
            this.y = Math.random() * canvas.height;
        }
        reset() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * -100;
            this.speed = Math.random() * 4 + 7;
            this.length = Math.random() * 10 + 10;
            this.opacity = Math.random() * 0.5 + 0.1;
        }
        update() {
            this.y += this.speed;
            if (this.y > canvas.height) this.reset();
        }
        draw() {
            ctx.beginPath();
            ctx.strokeStyle = `rgba(174, 194, 224, ${this.opacity})`;
            ctx.lineWidth = 1.5;
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.x, this.y + this.length);
            ctx.stroke();
        }
    }

    for (let i = 0; i < numDrops; i++) {
        drops.push(new Drop());
    }

    function animateRain() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drops.forEach(drop => {
            drop.update();
            drop.draw();
        });
        requestAnimationFrame(animateRain);
    }
    animateRain();

    // ========== 2. ë°˜ë”§ë¶ˆì´ ==========
    const scene = document.getElementById('scene');
    function spawnFirefly() {
        const firefly = document.createElement('div');
        firefly.classList.add('firefly');

        const rainRect = canvas.getBoundingClientRect();
        const randomX = rainRect.left + (Math.random() * rainRect.width);
        const randomY = rainRect.top + (Math.random() * rainRect.height);
        firefly.style.left = `${randomX}px`;
        firefly.style.top = `${randomY}px`;

        const duration = 3 + Math.random() * 3;
        firefly.style.animation = `floatUp ${duration}s ease-out forwards`;
        scene.appendChild(firefly);

        setTimeout(() => firefly.remove(), duration * 1000);
    }
    setInterval(spawnFirefly, 500);

    // ========== 3. í™”ë¶„ ë¡œì§ ==========
    const potImg = document.getElementById('pot'); 
    const guideText = document.getElementById('guideText');
    const potImages = ['í™”ë¶„1.PNG', 'í™”ë¶„2.PNG', 'í™”ë¶„3.PNG'];

    scene.addEventListener('click', (e) => {
        // ì‚¬ì´ë“œë°” í´ë¦­ ì‹œì—ëŠ” ë¬´ì‹œ
        if (e.target.closest('.sidebar-overlay')) return;

        const x = e.clientX;
        const y = e.clientY;
        const windowHeight = window.innerHeight;
        const shelfThreshold = windowHeight * 0.85; 

        if (guideText && guideText.style.opacity !== '0') {
            guideText.style.opacity = 0;
        }

        // í™”ë©´ ì•„ë˜ 15% ì •ë„ì—ë§Œ í™”ë¶„ì´ ë†“ì´ë„ë¡
        if (y > shelfThreshold) {
            const randomIndex = Math.floor(Math.random() * potImages.length);
            const selectedPot = potImages[randomIndex];
            potImg.style.backgroundImage = `url('${selectedPot}')`;
            potImg.style.opacity = 1;
            potImg.style.left = `${x}px`;
            potImg.style.top = `${y}px`;
        }
    });

    // ========== 4. íƒ€ì´ë¨¸ + ë””í†¡ìŠ¤ ì ê¸ˆ ==========
    let timerInterval = null;
    let timerRemainingMs = 0;
    let timerRunning = false;
    let detoxSessionActive = false;

    const display = document.getElementById('timerDisplay');
    const minInput = document.getElementById('timerMin');
    const secInput = document.getElementById('timerSec');
    const startBtn = document.getElementById('timerStartBtn');
    const pauseBtn = document.getElementById('timerPauseBtn');
    const resetBtn = document.getElementById('timerResetBtn');
    const lockStatus = document.getElementById('lockStatus');
    const detoxLockBtn = document.getElementById('detoxLockBtn');
    const alarmSoundEl = document.getElementById('alarmSound');

    // ìŒìˆ˜/ì§€ìˆ˜ ì…ë ¥ ë°©ì§€
    function blockNegative(inputEl) {
        if (!inputEl) return;
        inputEl.addEventListener('keydown', (e) => {
            if (e.key === '-' || e.key === 'e') {
                e.preventDefault();
            }
        });
        inputEl.addEventListener('input', () => {
            let n = parseInt(inputEl.value || '0', 10);
            if (isNaN(n) || n < 0) n = 0;
            inputEl.value = n;
        });
    }
    blockNegative(minInput);
    blockNegative(secInput);

    function formatTime(ms) {
        const totalSec = Math.max(0, Math.floor(ms / 1000));
        const m = String(Math.floor(totalSec / 60)).padStart(2, '0');
        const s = String(totalSec % 60).padStart(2, '0');
        return `${m}:${s}`;
    }

    function updateDisplay() {
        if (display) display.textContent = formatTime(timerRemainingMs);
    }
    updateDisplay();

    function readTimerFromInput() {
        if (!minInput || !secInput) return 0;
        const m = parseInt(minInput.value || '0', 10);
        const s = parseInt(secInput.value || '0', 10);
        let total = (m * 60 + s) * 1000;
        if (isNaN(total) || total < 0) total = 0;
        return total;
    }

    function updateLockStatus(text) {
        if (lockStatus) lockStatus.textContent = text;
    }

    function onTimerFinished() {
        timerRunning = false;
        // ì•ŒëŒ ì¬ìƒ
        if (alarmSoundEl) {
            try {
                alarmSoundEl.currentTime = 0;
                const p = alarmSoundEl.play();
                if (p && typeof p.then === 'function') p.catch(() => {});
            } catch (e) {}
        }

        if (detoxSessionActive) {
            detoxSessionActive = false;
            updateLockStatus('ìƒíƒœ: ì™„ë£Œ (ë””í†¡ìŠ¤ ì„¸ì…˜ ì¢…ë£Œ)');
            alert('ë””ì§€í„¸ ë””í†¡ìŠ¤ ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì²œì²œíˆ ëˆˆì„ ëœ¨ê³ , ëª¸ì„ ê°€ë³ê²Œ í’€ì–´ì£¼ì„¸ìš”.');
        } else {
            alert('íƒ€ì´ë¨¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        if (alarmSoundEl) {
            alarmSoundEl.pause();
            alarmSoundEl.currentTime = 0;
        }
    }

    function startTimer() {
        if (timerRunning) return;

        if (timerRemainingMs <= 0) {
            timerRemainingMs = readTimerFromInput();
            if (timerRemainingMs <= 0) {
                alert('ë¶„/ì´ˆë¥¼ ì…ë ¥í•œ ë’¤ ì‹œì‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
                return;
            }
        }

        timerRunning = true;
        const startTime = Date.now();
        const startRemaining = timerRemainingMs;

        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const nextRemaining = startRemaining - elapsed;

            if (nextRemaining <= 0) {
                timerRemainingMs = 0;
                updateDisplay();
                clearInterval(timerInterval);
                onTimerFinished();
            } else {
                timerRemainingMs = nextRemaining;
                updateDisplay();
            }
        }, 200);

        updateDisplay();
    }

    function pauseTimer() {
        if (!timerRunning) return;
        timerRunning = false;
        clearInterval(timerInterval);
    }

    function resetTimer() {
        timerRunning = false;
        clearInterval(timerInterval);
        timerRemainingMs = 0;
        detoxSessionActive = false;
        updateDisplay();
        if (minInput) minInput.value = '';
        if (secInput) secInput.value = '';
        updateLockStatus('ìƒíƒœ: ëŒ€ê¸° ì¤‘');
    }

    if (startBtn) {
        startBtn.addEventListener('click', () => {
            detoxSessionActive = false;
            updateLockStatus('ìƒíƒœ: ëŒ€ê¸° ì¤‘');
            startTimer();
        });
    }
    if (pauseBtn) pauseBtn.addEventListener('click', pauseTimer);
    if (resetBtn) resetBtn.addEventListener('click', resetTimer);

    if (detoxLockBtn) {
        detoxLockBtn.addEventListener('click', () => {
            if (!timerRunning && timerRemainingMs <= 0) {
                timerRemainingMs = readTimerFromInput();
                if (timerRemainingMs <= 0) {
                    alert('ë””í†¡ìŠ¤ ì„¸ì…˜ ì „ì— íƒ€ì´ë¨¸ ì‹œê°„ì„ ë¨¼ì € ì„¤ì •í•´ ì£¼ì„¸ìš”.');
                    return;
                }
            }
            detoxSessionActive = true;
            updateLockStatus('ìƒíƒœ: ì§„í–‰ ì¤‘ (ë””ì§€í„¸ ë””í†¡ìŠ¤ ì„¸ì…˜)');

            if (!timerRunning) {
                startTimer();
            } else {
                alert('ì´ë¯¸ íƒ€ì´ë¨¸ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. í˜„ì¬ íƒ€ì´ë¨¸ê°€ ë””í†¡ìŠ¤ ì„¸ì…˜ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.');
            }
        });
    }

    // ========== 5. ë¹„ ì†Œë¦¬ ë²„íŠ¼ ë¡œì§ ==========
    const rainSound = document.getElementById('rainSound');
    const soundBtns = document.querySelectorAll('.sound-btn');

    soundBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ active í† ê¸€
            soundBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const type = btn.dataset.sound;

            if (type === 'none') {
                rainSound.pause();
            } else {
                if (type === 'calm') {
                    rainSound.volume = 0.3;
                } else {
                    rainSound.volume = 1.0;
                }
                rainSound.play().catch(() => {});
            }
        });
    });

    // ========== 6. ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ==========
    document.getElementById('backBtn').addEventListener('click', () => {
        alert('ì´ì „ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        if (window.history.length > 1) {
            window.history.back();
        } else {
            window.location.href = 'index.html';
        }
    });
</script>
</body>
</html>
